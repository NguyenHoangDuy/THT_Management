@using THT.Models
<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">-->

    <title> @ViewBag.Title </title>
    <meta name="description" content="">
    <meta name="author" content="">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Basic Styles -->
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("~/css/bootstrap.min.css")">
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("~/css/font-awesome.min.css")">
    <link href="~/css/jquery-confirm.min.css" rel="stylesheet" />
    <!-- SmartAdmin Styles : Please note (smartadmin-production.css) was created using LESS variables -->
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("~/css/smartadmin-production.min.css")">
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("~/css/smartadmin-skins.min.css")">
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("~/css/CustomStyles.css")">


    <!-- SmartAdmin RTL Support is under construction
         This RTL CSS will be released in version 1.5
    <link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-rtl.min.css"> -->
    <!-- We recommend you use "your_style.css" to override SmartAdmin
         specific styles this will also ensure you retrain your customization with each SmartAdmin update.
    <link rel="stylesheet" type="text/css" media="screen" href="css/your_style.css"> -->
    <!-- Demo purpose only: goes with demo.js, you can delete this css when designing your own WebApp -->
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("~/css/demo.min.css")">

    <!-- FAVICONS -->
    <link rel="shortcut icon" href="@Url.Content("~/img/THT_favicon.png")" type="image/x-icon">
    <link rel="icon" href="@Url.Content("~/img/THT_favicon.png")" type="image/x-icon">

    <!-- GOOGLE FONT -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700">

    <!-- ThaoNX new icon -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <!-- Specifying a Webpage Icon for Web Clip
         Ref: https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html -->
    <link rel="apple-touch-icon" href="@Url.Content("~/img/splash/sptouch-icon-iphone.png")">
    <link rel="apple-touch-icon" sizes="76x76" href="@Url.Content("~/img/splash/touch-icon-ipad.png")">
    <link rel="apple-touch-icon" sizes="120x120" href="@Url.Content("~/img/splash/touch-icon-iphone-retina.png")">
    <link rel="apple-touch-icon" sizes="152x152" href="@Url.Content("~/img/splash/touch-icon-ipad-retina.png")">

    <!-- iOS web-app metas : hides Safari UI Components and Changes Status Bar Appearance -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Startup image for web apps -->
    <link rel="apple-touch-startup-image" href="@Url.Content("~/img/splash/ipad-landscape.png")" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)">
    <link rel="apple-touch-startup-image" href="@Url.Content("~/img/splash/ipad-portrait.png")" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)">
    <link rel="apple-touch-startup-image" href="@Url.Content("~/img/splash/iphone.png")" media="screen and (max-device-width: 320px)">

    <!-- Link to Google CDN's jQuery + jQueryUI; fall back to local -->
    <script src="@Url.Content("~/Scripts/kendo/2015.1.429/jquery.min.js")"></script>
    <script>
        if (!window.jQuery) {
            document.write('<script src="@Url.Content("~/js/libs/jquery-2.0.2.min.js")"><\/script>');
        }
    </script>

    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script>
        if (!window.jQuery.ui) {
            document.write('<script src="@Url.Content("~/js/libs/jquery-ui-1.10.3.min.js")"><\/script>');
        }
    </script>
    <link href="@Url.Content("~/Content/kendo/2015.1.429/kendo.common.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/kendo/2015.1.429/kendo.mobile.all.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/kendo/2015.1.429/kendo.dataviz.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/customkendo.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/chosen.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/daterangepicker.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Scripts/jquery.blockUI.js")"></script>
    <script src="~/Scripts/jquery-confirm.min.js"></script>
    <script>
        var ROOT = '@Url.Content("~/")';
        var r = ROOT.substring(0, ROOT.length - 1);
        var rootUrl = r;
    </script>
    <script src="@Url.Content("~/Scripts/kendo.modernizr.custom.js")"></script>
</head>
<body class="smart-style-3 animated " style="font-size: 12px !important; font-family: Tahoma, Verdana, Segoe, sans-serif;">
    @Html.Partial("Loading")
    <div id="divMaskPopup" onclick="hideMaskPopup('#divMaskPopup')"></div>
    <!-- possible classes: minified, fixed-ribbon, fixed-header, fixed-width-->
    <!-- HEADER -->
    <header id="header">
        <div id="logo-group">
            <span id="logo" style="margin-left:-3px;margin-top:0">
                <a href="@Url.Content("~/")"><img src="@Url.Content("~/img/THT_Logo1.png")" alt="SmartAdmin" style="width:219px; height:52px"></a>
            </span>
        </div>
        <!-- pulled right: nav area -->
        @*<div class="pull-right" style=" margin-right:15px;">
                <ul style="list-style: none; width: 217px">
                    <li style="margin-top:5px; width:200px">
                        <a data-toggle="dropdown" href="javascript:void(0);" style="text-decoration:none">
                            <img src="@Url.Content("~/img/avatars/male.png")" alt="me" class="online" height="40" style="margin-top:0px;" />
                            <span style="color:white">
                                <small>Xin chào,</small>
                                @User.Identity.Name
                            </span>
                            <i class="fa fa-angle-down" style="color :white;"></i>
                        </a>
                        <ul class="pull-right dropdown-menu" style="min-width: 197px;margin-right:9px; background: #eee; border-bottom: 1px solid #ADADAD">
                            <li style="padding:5px 0;" class="icon-off" id="logout">
                                <a href="@Url.Content("~/account/logoff")" id="logout">
                                    Đăng xuất
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)" id="btnChangePass">
                                    Đổi mật khẩu
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>*@
        <div class="pull-right">
            <div id="hide-menu" class="btn-header pull-right">
                <span> <a class="new_bg" href="javascript:void(0);" data-action="toggleMenu" title="Thu nhỏ menu"><i class="fa fa-reorder"></i></a> </span>
            </div>

            <!-- fullscreen button -->
            <div id="fullscreen" class="btn-header transparent pull-right">
                <span> <a class="new_bg" href="javascript:void(0);" data-action="launchFullscreen" title="Toàn màn hình"><i class="fa fa-arrows-alt"></i></a> </span>
            </div>
            <!-- end fullscreen button -->
            <!-- profile button -->
            @*<div id="profile" class="btn-header transparent pull-right" data-toggle="popover">
                    <span>
                        <a class="new_bg" href="javascript:void(0);" title="Thông báo" style="position: relative;"><i class="fa fa-bell"></i><b class="badge bg-color-red bounceIn animated" style="position: absolute; top: -10px; right: -15px; display: none;" id="number_notify"> 5 </b></a>
                    </span>
                </div>*@

            <div style="display: none; width: 600px;" class="alert_list">
                <ul class="nav nav-tabs nav-justified" role="tablist">
                    <li role="presentation" class="active"><a onclick="onActiveTab(this)" class="popover-item" href="javascript:void(0);" title="Message">Thông báo</a></li>
                    <li role="presentation" class=""><a onclick="onActiveTab(this)" class="popover-item" href="javascript:void(0);" title="Thông tin">Hiệu suất</a></li>
                </ul>
                <div class="popover-content-profile">
                </div>
            </div>
            <!-- end profile button -->
        </div>
        <!-- end pulled right: nav area -->
        <div class="pull-right" style="display: inline-flex; padding: 7px 10px 0px 0px; margin-right: 10px; border-right: 1px white dotted;">
            @{
                    var dataUser = Auth_User.GetUserNameById(User.Identity.Name);
                }

                @if (!string.IsNullOrEmpty(dataUser.AvatarPath))
                {
                    <div style="margin-right: 10px;">
                        <span id="btnEditInfor">
                            <img style="height:36px;width:36px;border: 2px solid #FFF;cursor:pointer" src="@Url.Content("~/Upload/Images/Avatar/" + dataUser.AvatarPath)" alt="@dataUser.DisplayName" class="img-circle AvatarPathUser" />
                        </span>
                    </div>
                }
                else
                {
                    <div style="margin-right: 10px;">
                        <span id="btnEditInfor">
                            <img style="height:36px;width:36px;border: 2px solid #FFF;cursor:pointer" src="@Url.Content("~/img/avatars/5.png")" alt="@dataUser.DisplayName" class="img-circle AvatarPathUser" />
                        </span>
                    </div>
                }

            <div style="color:white;">
                Xin chào,<b> @dataUser.DisplayName </b><br />
                <a id="btnChangePass" href="javascript:void(0);" title="Change password" style="color:white;font-size: 12px;">Đổi mật khẩu</a> |
                <a id="logout" href="@Url.Content("~/account/logoff")" title="Đăng xuất" style="color:white;font-size: 12px;">Đăng xuất</a>
            </div>
        </div>
    </header>
    <aside id="left-panel">
        <input type="hidden" id="currentUserIDLayout" value="@User.Identity.Name" />
        <nav>
            <ul id="menuLeft">
                @{
                    var listAllMenu = new Auth_Menu().GetAllMenu();
                    var listRoot = listAllMenu.Where(p => p.ParentMenuID == "").OrderBy(p => p.MenuIndex).ToList();
                    var viewMenu = ViewData.ContainsKey("menuView") ? (Dictionary<string, bool>)ViewData["menuView"] : new Dictionary<string, bool>();
                }
                @foreach (var root in listRoot)
                {
                    if (viewMenu.ContainsKey("menu_" + root.MenuID) && viewMenu["menu_" + root.MenuID])
                    {
                        <li>
                            @{
                        var listItem = listAllMenu.Where(p => p.ParentMenuID == root.MenuID).OrderBy(p => p.MenuIndex).ToList();
                            }
                            @if (listItem.Count > 0)
                            {

                                if (root.MenuIndex == 2)
                                {
                                    <a href="#"><i class="fa fa-lg fa-fw fa-cogs"></i> <span class="menu-item-parent">@root.MenuName</span></a>
                                }
                                else if (root.MenuIndex == 3)
                                {
                                    <a href="#"><i class="fa fa-building fa-1"></i> <span class="menu-item-parent">@root.MenuName</span></a>
                                }
                                else if (root.MenuIndex == 4)
                                {
                                    <a href="#"><i class="fa fa-child fa-1"></i> <span class="menu-item-parent">@root.MenuName</span></a>
                                }
                                else if (root.MenuIndex == 5)
                                {
                                    <a href="#"><i class="fa fa-truck fa-1"></i> <span class="menu-item-parent">@root.MenuName</span></a>
                                }
                                else if (root.MenuIndex == 6)
                                {
                                    <a href="#"><i class="fa fa-university  fa-1"></i> <span class="menu-item-parent">@root.MenuName</span></a>
                                }
                                else if (root.MenuIndex == 9)
                                {
                                    <a href="#"><i class="fa fa-lg fa-fw fa-bar-chart-o"></i> <span class="menu-item-parent">@root.MenuName</span></a>
                                }
                                <ul id="ul_root_@root.MenuIndex">
                                    @foreach (var item in listItem)
                                    {
                                        if (viewMenu.ContainsKey("menu_" + item.MenuID) && viewMenu["menu_" + item.MenuID])
                                        {
                                            <li>
                                                @{
                                            listItem = listAllMenu.Where(p => p.ParentMenuID == item.MenuID).OrderBy(p => p.MenuIndex).ToList();
                                                }
                                                @if (listItem.Count > 0)
                                                {
                                                    <a href="#"><span class="menu-item-parent">@item.MenuName</span></a>
                                                    <ul id="ul_item_@item.MenuIndex">
                                                        @foreach (var item2 in listItem)
                                                        {
                                                            if (viewMenu.ContainsKey("menu_" + item2.MenuID) && viewMenu["menu_" + item2.MenuID])
                                                            {
                                                                <li>
                                                                    @{
                                                                listItem = listAllMenu.Where(p => p.ParentMenuID == item2.MenuID).OrderBy(p => p.MenuIndex).ToList();
                                                                    }
                                                                    @if (listItem.Count > 0)
                                                                    {
                                                                        <a href="#"><span class="menu-item-parent">@item2.MenuName</span></a>
                                                                        <ul id="ul_item2_@item2.MenuIndex">
                                                                            @foreach (var item3 in listItem)
                                                                            {
                                                                                if (viewMenu.ContainsKey("menu_" + item3.MenuID) && viewMenu["menu_" + item3.MenuID])
                                                                                {
                                                                                    <li>
                                                                                        <a href="@Url.Content("~/" + item3.ControllerName)" id="menu_@item3.ControllerName">@item3.MenuName</a>
                                                                                    </li>
                                                                                }
                                                                            }
                                                                        </ul>
                                                                    }
                                                                    else
                                                                    {
                                                                        <a href="@Url.Content("~/" + item2.ControllerName)" id="menu_@item2.ControllerName">@item2.MenuName</a>
                                                                    }
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                }
                                                else
                                                {
                                                    <a href="@Url.Content("~/" + item.ControllerName)" id="menu_@item.ControllerName">@item.MenuName</a>
                                                }
                                            </li>
                                        }
                                    }
                                </ul>
                            }
                            else
                            {
                                <a href="@Url.Content("~/.")" id="menu_@root.ControllerName">
                                    <i class="fa fa-lg fa-fw fa-home"></i> <span class="menu-item-parent">@root.MenuName</span>
                                </a>
                            }
                        </li>
                    }
                }
            </ul>
        </nav>
        <span class="minifyme" data-action="minifyMenu">
            <i class="fa fa-arrow-circle-left hit"></i>
        </span>
    </aside>

    <!-- END NAVIGATION -->
    <!-- MAIN PANEL -->
    <div id="main" role="main">
        <div class="breadcrumbs" id="breadcrumbs">
            <ul class="breadcrumb" style="padding-left:8px !important">
                <li>
                    <i class="fa fa-home"></i>
                    <a href="@Url.Content("~/Home/")">Trang chủ</a>
                    <span>
                        <i class="fa fa-angle-right" style="margin-left: 5px;margin-right:5px"></i>
                        <a class="active">@ViewBag.Title </a>
                    </span>
                </li>
            </ul>
            <!--.breadcrumb-->
        </div>
        <div id="content">
            @RenderBody()
        </div>
    </div>
    <div id="divChangePass"></div>
    <div id="divEditinfor"></div>
    <script src="@Url.Content("~/js/app.config.js")"></script>

    <!-- JS TOUCH : include this plugin for mobile drag / drop touch events-->
    <script src="@Url.Content("~/js/plugin/jquery-touch/jquery.ui.touch-punch.min.js")"></script>

    <!-- BOOTSTRAP JS -->
    <script src="@Url.Content("~/js/bootstrap/bootstrap.min.js")"></script>

    <!-- CUSTOM NOTIFICATION -->
    <script src="@Url.Content("~/js/notification/SmartNotification.min.js")"></script>

    <!-- JARVIS WIDGETS -->
    <script src="@Url.Content("~/js/smartwidgets/jarvis.widget.min.js")"></script>

    <!-- EASY PIE CHARTS -->
    <script src="@Url.Content("~/js/plugin/easy-pie-chart/jquery.easy-pie-chart.min.js")"></script>

    <!-- SPARKLINES -->
    <script src="@Url.Content("~/js/plugin/sparkline/jquery.sparkline.min.js")"></script>

    <!-- JQUERY VALIDATE -->
    <script src="@Url.Content("~/js/plugin/jquery-validate/jquery.validate.min.js")"></script>

    <!-- JQUERY MASKED INPUT -->
    <script src="@Url.Content("~/js/plugin/masked-input/jquery.maskedinput.min.js")"></script>

    <!-- JQUERY SELECT2 INPUT -->
    <script src="@Url.Content("~/js/plugin/select2/select2.min.js")"></script>

    <!-- JQUERY UI + Bootstrap Slider -->
    <script src="@Url.Content("~/js/plugin/bootstrap-slider/bootstrap-slider.min.js")"></script>

    <!-- browser msie issue fix -->
    <script src="@Url.Content("~/js/plugin/msie-fix/jquery.mb.browser.min.js")"></script>

    <!-- FastClick: For mobile devices -->
    <script src="@Url.Content("~/js/plugin/fastclick/fastclick.min.js")"></script>

    <!--[if IE 8]>

    <h1>Your browser is out of date, please update your browser by going to www.microsoft.com/download</h1>

    <![endif]-->
    <!-- Demo purpose only -->
    <script src="@Url.Content("~/js/demo.min.js")"></script>

    <!-- MAIN APP JS FILE -->
    <script src="@Url.Content("~/js/app.min.js")"></script>

    <!-- ENHANCEMENT PLUGINS : NOT A REQUIREMENT -->
    <!-- Voice command : plugin -->
    <script src="@Url.Content("~/js/speech/voicecommand.min.js")"></script>

    <!-- PAGE RELATED PLUGIN(S) -->
    <!-- Flot Chart Plugin: Flot Engine, Flot Resizer, Flot Tooltip -->
    <script src="@Url.Content("~/js/plugin/flot/jquery.flot.cust.min.js")"></script>
    <script src="@Url.Content("~/js/plugin/flot/jquery.flot.resize.min.js")"></script>
    <script src="@Url.Content("~/js/plugin/flot/jquery.flot.tooltip.min.js")"></script>

    <!-- Vector Maps Plugin: Vectormap engine, Vectormap language -->
    <script src="@Url.Content("~/js/plugin/vectormap/jquery-jvectormap-1.2.2.min.js")"></script>
    <script src="@Url.Content("~/js/plugin/vectormap/jquery-jvectormap-world-mill-en.js")"></script>

    <!-- Full Calendar -->
    <script src="@Url.Content("~/js/plugin/fullcalendar/jquery.fullcalendar.min.js")"></script>

    <script src="@Url.Content("~/Scripts/kendo/2015.1.429/jszip.min.js")"></script>
    <script src="@Url.Content("~/Scripts/kendo/2015.1.429/kendo.all.min.js")"></script>
    <script src="@Url.Content("~/Scripts/kendo/2015.1.429/kendo.aspnetmvc.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.form.js")"></script>
    <script src="@Url.Content("~/Scripts/chosen.jquery.min.js")"></script>
    <script src="@Url.Content("~/Scripts/app/page.js")"></script>
    <script src="@Url.Content("~/Scripts/daterangepicker.min.js")"></script>
    <script src="@Url.Content("~/Scripts/moment.min.js")"></script>
    <script src="@Url.Content("~/Scripts/autoNumeric.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.number.js")"></script>

    <script>
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#formPopupEditInfor .AvatarPathUser')
                        .attr('src', e.target.result)
                };

                reader.readAsDataURL(input.files[0]);
            }
            else {
                $('#formPopupEditInfor .AvatarPathUser').attr('src', r + "/img/avatars/5.png");
            }
        }
        function onPopupOpenEvent(e) {
            if (e == null || e == '') {
                indexTabstripActive = -1;
                $("#divMaskPopup").hide();
                eventHotKey = false;
                return;
            }
            else {
                eventHotKey = true;
                e.parent().attr({
                    'isActive': true
                });
                $("#divMaskPopup").show();
            }
        }
        function showPopupEditInfor(userID) {
            debugger
            idEditInfor = userID;
            idPopup = ".k-window";
            //$("#divMaskPopup").show();
            //code moi cho ham show poupup

            $.get(r + "/Auth_User/PartialEditInfor", { userID: idEditInfor }, function (data) {
                if (data) {
                    $("#popupEditInfor").parent().remove();
                    $("#divEditinfor").empty().html(data);
                    $("#formPopupEditInfor #btnClose").click(function () {
                        //actionComfirmActionLink({ "controller": "Product", "title": "Sản phẩm" });
                        // hideMaskPopup("#divMaskPopup");
                    });

                    //==========================================================form popup edit infor====================================================
                    $('#popupEditInfor').kendoWindow({
                        width: "900px",
                        actions: ["Close"],
                        visible: false,
                        resizable: false,
                        close: function (e) {
                            $("#divMaskPopup").hide();
                        },
                    });
                    //====================================end=================================[
                    //==================================mainform validate===============================
                    $('#formPopupEditInfor #BirthdayString').datepicker({
                        dateFormat: 'dd/mm/yy',
                        prevText: '<i class="fa fa-chevron-left"></i>',
                        nextText: '<i class="fa fa-chevron-right"></i>',
                    });

                    //generateSelect2('s', 'formPopupEditInfor #IsActive', null, '240px');

                    $("#formPopupEditInfor").validate({
                        // Rules for form validation
                        rules: {
                            DisplayName: {
                                required: true
                            },
                            FullName: {
                                required: true
                            },
                            Email: {
                                email: true
                            },

                        },

                        // Messages for form validation
                        messages: {
                            DisplayName: {
                                required: "Thông tin bắt buộc"
                            },
                            FullName: {
                                required: "Thông tin bắt buộc"
                            },
                            Email: {
                                email: "Sai Email"
                            }
                        },
                        // Do not change code below
                        errorPlacement: function (error, element) {
                            error.insertAfter(element);
                        },

                        submitHandler: function (form) {
                            $(form).ajaxSubmit({
                                //clearForm: true,//To clear form after ajax submitting
                                beforeSend: function () {
                                    $("#loading").removeClass('hide');
                                    blockUIFromUser();
                                },
                                success: function (data) {
                                    if (data.success) {
                                        blockUIFromUser();
                                        var value = data.data;
                                        if (value.AvatarPath == "" || value.AvatarPath == null) {
                                            $(".AvatarPathUser").attr("src", r + "/img/avatars/5.png");
                                        } else {
                                            $(".AvatarPathUser").attr("src", r + "/Upload/Images/Avatar/" + value.AvatarPath);
                                        }
                                        alertBox("Lưu thành công", "", true, 3000);
                                        $("#grid").data("kendoGrid").dataSource.read();
                                    }
                                    else {
                                        alertBox("Có lỗi", data.message, false, 3000);
                                        console.log(data.message);
                                    }
                                    $("#loading").addClass('hide');
                                }
                            });
                            return false;
                        }
                    });

                    $("#formPopupEditInfor #ProvinceID").change(function () {
                        getListItem({ id: $(this).val() }, 'formPopupEditInfor #DistrictID', 'Auth_User', 'GetDistrictByProvince', '240px');
                    });

                    //======================================end=============================================

                    //get popup
                    $("#formPopupEditInfor").find('section em').remove();
                    $("#formPopupEditInfor").find('section label').removeClass('state-error').removeClass('state-success');
                    idPopup = ".k-window";
                    //$("#divMaskPopup").show();
                    var popup = $('#popupEditInfor').data("kendoWindow");
                    popup.center().open();
                    $(".k-window span.k-i-close").click(function () {
                        $("#divMaskPopup").hide();
                    });
                    // Update
                    popup.title('Thông tin người dùng');
                    var id = idEditInfor;
                    $("#formPopupEditInfor").find('fieldset:eq(0) section:eq(0)').empty().append('<label class="label" style="float: left;">Mã người dùng (*) </label><label style="float: right;text-align: left;width: 240px;height: 19px;padding-top: 2px;"><strong style="color:red;">' + id + '</strong><input type="hidden" id="UserID" name="UserID" value="' + id + '"/></label> <div style="clear:both"></div>');
                    setTimeout(function () {
                        $("#DisplayName").focus();
                    }, 500);
                    blockUIFromUser();
                    $.post(r + "/Auth_User/GetUserByID", { userID: id }, function (data) {
                        if (data.success) {
                            debugger
                            var value = data.data;
                            var active = value.IsActive == true ? "True" : "False";
                            $("#formPopupEditInfor #UserID").val(value.UserID);
                            $("#formPopupEditInfor #DisplayName").val(value.DisplayName);
                            $("#formPopupEditInfor #FullName").val(value.FullName);
                            //if (value.Birthday == "/Date(-62135596800000)/") {
                            //    $("#formPopupEditInfor #BirthdayString").val(birthday);
                            //}
                            //else
                            //    $("#formPopupEditInfor #BirthdayString").val(dateToString(value.Birthday));

                            $("#formPopupEditInfor #BirthdayString").val(dateToString(value.Birthday));
                            //generateSelect2('s', 'formPopupEditInfor #IsActive', active, '240px');
                            $("#formPopupEditInfor #Note").val(value.Note);
                            getListItem({ Level: 'Province' }, 'formPopupEditInfor #ProvinceID', 'Auth_User', 'GetProvinceDDL', '240px');
                            generateSelect2('s', 'formPopupEditInfor #ProvinceID', value.ProvinceID, '240px');
                            getListItem({ id: value.ProvinceID }, 'formPopupEditInfor #DistrictID', 'Auth_User', 'GetDistrictByProvince', '240px');
                            generateSelect2('s', 'formPopupEditInfor #DistrictID', value.DistrictID, '240px');


                            //getListItem({ id: value.Roles }, 'formPopupEditInfor #Roles', 'Auth_User', 'GetDistrictByProvince', '240px');


                            $("#formPopupEditInfor #Address").val(value.Address);
                            $("#formPopupEditInfor #Phone").val(value.Phone);
                            $("#formPopupEditInfor #Email").val(value.Email);
                            $("#formPopupEditInfor #RowCreatedBy").val(value.RowCreatedBy);
                            $("#formPopupEditInfor #RowCreatedAt").val(dateToString(value.RowCreatedAt));
                            $("#formPopupEditInfor #AvatarPath").val(value.AvatarPath);

                            $("#listRolesID").select2();
                            $("#s2id_listRolesID").css('width', '668px');
                            $("#s2id_listRolesID").css('margin-left', '10px');
                            $("#listBrandsID").select2();
                            $("#s2id_listBrandsID").css('width', '668px');
                            $("#s2id_listBrandsID").css('margin-left', '10px');

                            debugger

                            //$.post(r + "/Auth_User/getBrandIDbyUserID/", { userID: id }, function (data) {
                            //    if (data.success) {
                            //        //debugger;

                            //        $("#listBrandsID option:selected").removeAttr('selected');
                            //        generateSelect2("listBrandsID");
                            //        var value = data.listBrandIDs;

                            //        for (var i = 0; i < value.length; i++) {
                            //            $("#listBrandsID option[value='" + value[i].BrandID + "']").attr('selected', true);
                            //        }
                            //        $("#listBrandsID").trigger("change");
                            //    }
                            //});

                            $.post(r + "/Auth_User/getRolesbyUserID/", { userID: id }, function (data) {
                                if (data.success) {
                                    //debugger;
                                    $("#listRolesID option:selected").removeAttr('selected');
                                    generateSelect2("listRolesID");
                                    var value = data.listRoleIDs;

                                    for (var i = 0; i < value.length; i++) {
                                        $("#listRolesID option[value='" + value[i].RoleID + "']").attr('selected', true);
                                    }
                                    $("#listRolesID").trigger("change");
                                }
                            });

                            //if (value.RowCreatedBy == "system") {
                            //    $('#formPopupEditInfor #btnSubmit').css({ 'display': 'none' })
                            //}
                            //else {
                            //    $('#formPopupEditInfor #btnSubmit').css({ 'display': 'block' })
                            //}

                            if (value.AvatarPath == "" || value.AvatarPath == null) {
                                $("#formPopupEditInfor .AvatarPathUser").attr("src", r + "/img/avatars/5.png");
                            } else {
                                $("#formPopupEditInfor .AvatarPathUser").attr("src", r + "/Upload/Images/Avatar/" + value.AvatarPath);
                            }
                        }
                        else {
                            alertBox("Có lỗi", "", false, 3000);
                            console.log(data.message);
                        }

                    });
                }

            });

        }

        function onDeleteAvatar() {
            readURL($('#ImagePath'));
        }

        function blockUIFromUser(isMark) {
            if (isMark) {
                $(document).ajaxStart($.blockUI({ message: '<i class="fa fa-spinner fa-3x fa-lg fa-spin txt-color-blueDark"></i>', theme: false })).ajaxStop($.unblockUI);
            }
            else {
                $(document).ajaxStart($.blockUI({ message: '<i class="fa fa-spinner fa-3x fa-lg fa-spin txt-color-blueDark"></i>', theme: false, overlayCSS: { backgroundColor: 'transparent' } })).ajaxStop($.unblockUI);
            }
        }

        function dateToString(date) {

            if (date != null) {
                date = new Date(date.match(/\d+/)[0] * 1);
                var day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var month = (date.getMonth() + 1) < 10 ? "0" + (date.getMonth() + 1) : (date.getMonth() + 1);
                return day + '/' + month + '/' + date.getFullYear();
            }
            else {
                return "";
            }
        }
        function imgError(image) {
            image.onerror = "";
            image.src = r + "/img/avatars/5.png";
            return true;
        }
        //generate select
        function generateSelect2(type, id, value, width) {
            var lstE = $("#" + id);
            if (lstE == null) {
                return false;
            }
            for (var i = 0; i < lstE.length; i++) {
                var selectE = $(lstE[i]);
                if (!selectE.is("select")) {
                    continue;
                }
                if (type == 'm') {
                    //kieu chon nhieu
                    selectE.select2();
                    var idSelectE = selectE.attr('id');
                    var s2idE = selectE.parent().find("#s2id_" + idSelectE);
                    if (s2idE.length == 0)
                        continue;

                    s2idE.css('width', width);
                    s2idE.find('input').css('width', width);
                    if ($('#' + id + ' option:selected').length > 0) {
                        $("#s2id_" + id + "  ul .select2-search-field input").css({ 'width': '10px' });
                    }
                }
                else if (type == 's') {
                    if (value == null || value == '') {
                        if (value === 0) {
                            $("#" + id + " option[value='0']").attr('selected', true);
                        }
                        else {
                            $("#" + id + " option:selected").removeAttr('selected');
                        }
                    }
                    else {
                        $("#" + id + " option[value='" + value + "']").attr('selected', true);
                    }
                    selectE.select2();
                    var idSelectE = selectE.attr('id');
                    if (selectE.prev().attr('id') == 's2id_' + idSelectE) {
                        selectE.prev().css('width', width);
                    }
                }
            }
        }
        function getListItem(data, idElementSet, routerName, method, width) {

            $.ajax({
                url: r + "/" + routerName + "/" + method,
                type: "post",
                async: false,
                data: data,
                beforeSend: function () {
                    blockUIFromUser(false);
                },
                success: function (data) {

                    if (data.success) {

                        var lstE = $("#" + idElementSet);
                        for (var i = 0; i < lstE.length; i++) {
                            var selectE = $(lstE[i]);
                            if (!selectE.is("select")) {
                                continue;
                            }

                            selectE.select2();
                            var item = '';
                            var optionDefault = selectE.find('option')[0];
                            selectE.find('option').remove();
                            if (typeof (optionDefault) != "undefined") {

                                item = '<option value="">' + optionDefault.textContent + '</option>';
                            }
                            else {
                                item = '<option value=""></option>';
                            }
                            for (var i = 0; i < data.data.length; i++) {
                                var value = data.data[i];
                                item += '<option value="' + value.ID + '">' + value.Name + '</option>';
                            }
                            selectE.append(item);
                            selectE.select2();
                            var idSelectE = selectE.attr('id');
                            if (selectE.prev().attr('id') == 's2id_' + idSelectE) {
                                selectE.prev().css('width', width);
                            }
                        }

                    }
                    else {
                        alertBox("Có lỗi", data.message, false, 3000);
                        console.log(data.message);
                    }

                }
            });
        }
        function generateWindow() {
            $.get(r + "/Home/PartialChangePass", {}, function (data) {
                if (data) {
                    $("#divChangePass").html(data);
                    $('#popupChangePass').kendoWindow({
                        width: "500",
                        actions: ["Close"],
                        visible: false,
                        title: "Đổi mật khẩu",
                        resizable: false,
                        close: function (e) {
                            $("#divMaskPopup").hide();
                        },

                    });

                    $("#formPopupChangePass").validate({
                        // Rules for form validation
                        rules: {
                            OldPass: { required: true },
                            NewPass: { required: true },
                            RepeatNewPass: { required: true }
                        },

                        // Messages for form validation
                        messages: {
                            OldPass: { required: "Nhập mật khẩu cũ" },
                            NewPass: { required: "Nhập mật khẩu mới" },
                            RepeatNewPass: { required: "Nhập lại mật khẩu mới" }
                        },

                        // Do not change code below
                        errorPlacement: function (error, element) {
                            error.insertAfter(element);
                        },

                        submitHandler: function (form) {
                            $(form).ajaxSubmit({
                                //clearForm: true,//To clear form after ajax submitting
                                beforeSend: function (xhr, opts) {
                                    $("#loading").removeClass('hide');
                                    var newPass = $("#NewPass").val();
                                    var repeatNewPass = $("#RepeatNewPass").val();
                                    if (newPass != repeatNewPass) {
                                        alertBox("Có lỗi", "Mật khẩu nhập lại không đúng", false, 3000);
                                        xhr.abort();
                                    }
                                },
                                success: function (data) {
                                    if (data.success) {
                                        $('#popupChangePass').data("kendoWindow").close();
                                        $("#divMaskPopup").hide();
                                        alertBox("Thành công! ", "Đổi mật khẩu thành công", true, 3000);
                                    }
                                    else {
                                        alertBox("Báo lỗi! ", data.message, false, 3000);
                                    }
                                    $("#loading").addClass('hide');
                                }
                            });
                            return false;
                        }
                    });
                    $('#popupChangePass').data("kendoWindow").center().open();
                    setTimeout(function () {
                        $("#OldPass").focus();
                    }, 500);
                }
            });
        }

        function alertBox(title, content, flag, timeout) {
            //var icon = flag ? "fa-thumbs-up" : "fa-thumbs-down";
            $.smallBox({
                title: title,
                content: content,
                color: flag ? "#e0efd8" : "#f2dedf",
                //iconSmall: "fa " + icon + " bounce animated",
                timeout: timeout
            });
        }

        $(document).ready(function () {
            $("#btnChangePass").click(function () {
                idPopup = ".k-window";
                $("#divMaskPopup").show();
                generateWindow();
            });
            $("#btnEditInfor").click(function () {
                idPopup = ".k-window";
                $("#divMaskPopup").show();

                var UserID = $('#currentUserIDLayout').val();
                showPopupEditInfor(UserID);
            });
            $(document).keyup(function (e) {
                if (e.keyCode == 27) {
                    $("#divMaskPopup").hide();
                    hideMaskPopup("#divMaskPopup");
                }
            });
            //Ctr + S luu form
            $(document).bind('keydown', function (event) {
                if (eventHotKey) {
                    if (event.ctrlKey || event.metaKey) {
                        switch (String.fromCharCode(event.which).toLowerCase()) {
                            case 's':
                                event.preventDefault();
                                var currentPopup = $('.k-widget.k-window[isActive="true"] .k-window-content.k-content');
                                if (typeof (currentPopup) == "undefined" || currentPopup == null || currentPopup == '' || currentPopup.length == 0) {
                                    return;
                                }

                                var popupId = currentPopup[0].id;
                                if (popupId == 'popupEditInfor') {
                                    $(':focus').blur();
                                    if ($("#formPopupEditInfor").valid()) {
                                        $("#formPopupEditInfor").submit();
                                    }
                                }
                                if (popupId == 'popupChangePass') {
                                    $(':focus').blur();
                                    if ($("#formPopupChangePass").valid()) {
                                        $("#formPopupChangePass").submit();
                                    }
                                }
                                break;
                        }
                    }
                }
            });
            // DO NOT REMOVE : GLOBAL FUNCTIONS!
            pageSetUp();

            /*
             * PAGE RELATED SCRIPTS
             */

            $(".js-status-update a").click(function () {
                var selText = $(this).text();
                var $this = $(this);
                $this.parents('.btn-group').find('.dropdown-toggle').html(selText + ' <span class="caret"></span>');
                $this.parents('.dropdown-menu').find('li').removeClass('active');
                $this.parent().addClass('active');
            });

            /*
            * TODO: add a way to add more todo's to list
            */

            // initialize sortable
            $(function () {
                $("#sortable1, #sortable2").sortable({
                    handle: '.handle',
                    connectWith: ".todo",
                    update: countTasks
                }).disableSelection();
            });

            // check and uncheck
            $('.todo .checkbox > input[type="checkbox"]').click(function () {
                var $this = $(this).parent().parent().parent();

                if ($(this).prop('checked')) {
                    $this.addClass("complete");

                    // remove this if you want to undo a check list once checked
                    //$(this).attr("disabled", true);
                    $(this).parent().hide();

                    // once clicked - add class, copy to memory then remove and add to sortable3
                    $this.slideUp(500, function () {
                        $this.clone().prependTo("#sortable3").effect("highlight", {}, 800);
                        $this.remove();
                        countTasks();
                    });
                } else {
                    // insert undo code here...
                }

            })
            // count tasks
            function countTasks() {

                $('.todo-group-title').each(function () {
                    var $this = $(this);
                    $this.find(".num-of-tasks").text($this.next().find("li").size());
                });

            }

            if ($("#calendar").length) {
                var date = new Date();
                var d = date.getDate();
                var m = date.getMonth();
                var y = date.getFullYear();

                var calendar = $('#calendar').fullCalendar({

                    editable: true,
                    draggable: true,
                    selectable: false,
                    selectHelper: true,
                    unselectAuto: false,
                    disableResizing: false,

                    header: {
                        left: 'title', //,today
                        center: 'prev, next, today',
                        right: 'month, agendaWeek, agenDay' //month, agendaDay,
                    },

                    select: function (start, end, allDay) {
                        var title = prompt('Event Title:');
                        if (title) {
                            calendar.fullCalendar('renderEvent', {
                                title: title,
                                start: start,
                                end: end,
                                allDay: allDay
                            }, true // make the event "stick"
                            );
                        }
                        calendar.fullCalendar('unselect');
                    },

                    events: [{
                        title: 'All Day Event',
                        start: new Date(y, m, 1),
                        description: 'long description',
                        className: ["event", "bg-color-greenLight"],
                        icon: 'fa-check'
                    }, {
                        title: 'Long Event',
                        start: new Date(y, m, d - 5),
                        end: new Date(y, m, d - 2),
                        className: ["event", "bg-color-red"],
                        icon: 'fa-lock'
                    }, {
                        id: 999,
                        title: 'Repeating Event',
                        start: new Date(y, m, d - 3, 16, 0),
                        allDay: false,
                        className: ["event", "bg-color-blue"],
                        icon: 'fa-clock-o'
                    }, {
                        id: 999,
                        title: 'Repeating Event',
                        start: new Date(y, m, d + 4, 16, 0),
                        allDay: false,
                        className: ["event", "bg-color-blue"],
                        icon: 'fa-clock-o'
                    }, {
                        title: 'Meeting',
                        start: new Date(y, m, d, 10, 30),
                        allDay: false,
                        className: ["event", "bg-color-darken"]
                    }, {
                        title: 'Lunch',
                        start: new Date(y, m, d, 12, 0),
                        end: new Date(y, m, d, 14, 0),
                        allDay: false,
                        className: ["event", "bg-color-darken"]
                    }, {
                        title: 'Birthday Party',
                        start: new Date(y, m, d + 1, 19, 0),
                        end: new Date(y, m, d + 1, 22, 30),
                        allDay: false,
                        className: ["event", "bg-color-darken"]
                    }, {
                        title: 'Smartadmin Open Day',
                        start: new Date(y, m, 28),
                        end: new Date(y, m, 29),
                        className: ["event", "bg-color-darken"]
                    }],

                    eventRender: function (event, element, icon) {
                        if (!event.description == "") {
                            element.find('.fc-event-title').append("<br /><span class='ultra-light'>" + event.description + "</span>");
                        }
                        if (!event.icon == "") {
                            element.find('.fc-event-title').append("<i class='air air-top-right fa " + event.icon + " '></i>");
                        }
                    }
                });

            };

            /* hide default buttons */
            $('.fc-header-right, .fc-header-center').hide();

            // calendar prev
            $('#calendar-buttons #btn-prev').click(function () {
                $('.fc-button-prev').click();
                return false;
            });

            // calendar next
            $('#calendar-buttons #btn-next').click(function () {
                $('.fc-button-next').click();
                return false;
            });

            // calendar today
            $('#calendar-buttons #btn-today').click(function () {
                $('.fc-button-today').click();
                return false;
            });

            // calendar month
            $('#mt').click(function () {
                $('#calendar').fullCalendar('changeView', 'month');
            });

            // calendar agenda week
            $('#ag').click(function () {
                $('#calendar').fullCalendar('changeView', 'agendaWeek');
            });

            // calendar agenda day
            $('#td').click(function () {
                $('#calendar').fullCalendar('changeView', 'agendaDay');
            });
        });
    </script>
    <!-- Your GOOGLE ANALYTICS CODE Below -->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-XXXXXXXX-X']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <style>
        #logo {
            margin-left: -3px;
            margin-top: 0;
        }
        /*.nav > li > a:focus, .nav > li > a:hover {
                    text-decoration: none;
                    background-color: #9D1D1E;
                    height:49px;
                }
                .nav .open > a, .nav .open > a:focus, .nav .open > a:hover {
                    background-color: #9D1D1E;
                    height: 49px;
                    border-color: #3276b1;
                }*/
    </style>
</body>
</html>